<html>
<head>

</head>
<body>

<div id="app">

    <url-list :urls="[
        {
            id: 1,
            url: 'url-slug-1'
        },
        {
            id: 2,
            url: 'url-slug-2'
        }
    ]"></url-list>

    <url-list :urls="[
        {
            id: 3,
            url: 'url-slug-3'
        },
        {
            id: 4,
            url: 'url-slug-4'
        }
    ]"></url-list>

    <div class="js-menu-builder">
        <megamenu-list :items="menuItems"></megamenu-list>
    </div>

    <button @click="addItem">Add New Item</button>
</div>



<template id="js-url-list-template">
    <div>
        <input type="search" placeholder="Filter Links" v-model="pageFilter">
        <div v-for="url in urls" v-if="!url.hidden">
            <label>
                <input type="checkbox" :value="url.id" v-model="selectedUrls">
                {{ url.url }}
            </label>
        </div>

        <label>
            <input type="checkbox" v-model="selectAll">
            Select All
        </label>
        <button @click="addUrl">Add Selected</button>
        {{ selectedUrls }}
    </div>
</template>

<template id="js-megamenu-list-template">
    <ol>
        <li v-for="item in items">
            <div>
                {{ item.title }}
                <button @click="deleteItem(item)">Remove</button>
            </div>
            <megamenu-list v-if="item.children" :items="item.children"></megamenu-list>
        </li>
    </ol>
</template>

<script src="js/vue.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
<script src="js/jquery.mjs.nestedSortable.js"></script>
<script>

    Vue.component('url-list', {
        template: '#js-url-list-template',
        props: ['urls'],
        data: function() {
            return {
                pageFilter: '',
                selectedUrls: [],
            }
        },
        methods: {
            addUrl: function () {

//                var selectedUrls = [];
//                selectedUrls = this.urls.filter(function(url) {
//                    return url.checked;
//                });
//                console.log(selectedUrls.length);
            },
        },
        computed: {
            selectAll: {
                get: function () {
                    return this.urls ? this.selectedUrls.length == this.urls.length : false;
                },
                set: function (value) {
                    var selected = [];

                    if (value) {
                        this.urls.forEach(function (url) {
                            selected.push(url.id);
                        });
                    }

                    this.selectedUrls = selected;
                }
            }
        }
    });

    Vue.component('megamenu-list', {
        template: '#js-megamenu-list-template',
        props: ['items'],
        methods: {
            deleteItem: function (item) {

                var itemIndex = this.items.indexOf(item);

                if (item.children) {

                    var itemChildren = item.children.reverse();

                    for (var i = 0; i < itemChildren.length; i++) {
                        // move the children up so they aren't deleted
                        this.items.splice(itemIndex, 0, itemChildren[i]);
                    }
                }

                this.items.$remove(item);
            },
        }
    });
    new Vue({
        el: '#app',
        data: {
            menuItems: [
                {
                    title: 'Item 1'
                },
                {
                    title: 'Item 2',
                    children: [
                        {
                            title: 'Item 2.1'
                        },
                        {
                            title: 'Item 2.2',
                            children: [
                                {
                                    title: 'Item 2.2.1'
                                },
                                {
                                    title: 'Item 2.2.2'
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        methods: {
            addItem: function() {
                var newItem = {title: 'Item'};

                this.menuItems.push(newItem);
            },
        },
        ready() {
            var vm = this;
            $('.js-menu-builder > ol').nestedSortable({
                handle: 'div',
                items: 'li',
                toleranceElement: '> div',
                change: function() {

                }
            });
        }
    });

</script>

</body>
</html>
